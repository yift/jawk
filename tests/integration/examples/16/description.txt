Group by with sorting and duplication removing